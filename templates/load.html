<!DOCTYPE html>
<head>
    <title>Carga monumentos</title>
    <link rel="stylesheet" href="../static/style_load.css">
</head>
<body>
    <div class="container">
        <div class="load_container">
            <h1>Carga del almacén de datos</h1>
            <div class="form_container">
                <h3>Selecciona fuente:</h3>
                <form id="load_form" action="post">
                    <label for="todas">Seleccionar todas</label>
                    <input type="checkbox" id="all" name="todas" value="all">
                    <label for="cat">Castilla y León</label>
                    <input type="checkbox" id="cat" name="cat" value="cat">
                    <label for="cv">Comunitat Valenciana</label>
                    <input type="checkbox" id="cv" name="cv" value="cv">
                    <label for="mur">Euskadi</label>
                    <input type="checkbox" id="mur" name="mur" value="mur">
                    <div class="buttons">
                        <button type="reset" class="cancel-btn">Cancelar</button>
                        <button type="submit" class="submit-btn">Cargar</button>
                        <button type="submit" class="delete-btn">Borrar almacén de datos</button>
                    </div>
                </form>
            </div>
            <div class="results">
                <h3>Resultados de Carga</h3>
                <div class="result-container">

                </div>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('load_form').addEventListener('submit', async function(event){
            event.preventDefault();

            const formData = new FormData(this);
            const selectedSources = [];

            const isAllSelected = formData.has('todas');

            if (isAllSelected) {
                selectedSources.push("cat", "cv", "mur");
            } else {
                if (formData.has('cat')) {
                    selectedSources.push("cat");
                }
                if (formData.has('cv')) {
                    selectedSources.push("cv");
                }
                if (formData.has('mur')) {
                    selectedSources.push("mur");
                }
            }
            
            const options = selectedSources.reduce((acc, source) => {
                acc[source] = source;
                return acc;
            }, {});
            const url = "url_api";
            const resultContainer = document.querySelector('.result-container');
            resultContainer.innerHTML='';

            const printResponse = (message) => {
                const resDiv = document.createElement('div');
                resDiv.innerHTML = `<p>${message}</p><br>`;
                resultContainer.appendChild(resDiv);
            };
            const response = await fetch(url, {
                method: 'POST',
                headers:{
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(options)
            });
            const data = await response.json();
            printResponse(data.message);
                
        });
    </script>
</body>